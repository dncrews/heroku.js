<!DOCTYPE html><html lang="en"><head><title>api</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="citare-relative-root" content=""><meta name="citare-document-path" content="api"><meta name="citare-project-path" content="lib/heroku/api.js"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="bg"></div><div id="meta"><div class="file-path">lib/heroku/api.js</div></div><div id="document" class="codedoc"><div class="segment"><div class="comments"><div class="wrapper"><h1><a name="heroku-api" class="anchor" href="#heroku-api"><span></span></a>Heroku API</h1>
<p> <div class="toc">&nbsp;&nbsp;&nbsp;&nbsp;<a href="#herokuapi-constructor">HerokuAPI Constructor</a><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#params">Params</a><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#examples">Examples</a><br/></div></p></div></div><div class="code"><div class="wrapper"><span class="string">'use strict'</span>;

<span class="keyword">var</span> extend = require(<span class="string">'node.extend'</span>)

  , superagent = require(<span class="string">'../helpers/superagent'</span>)

  , addons = require(<span class="string">'./api/addons'</span>)
  , apps = require(<span class="string">'./api/apps'</span>)
  , attachments = require(<span class="string">'./api/attachments'</span>)
  , collaborators = require(<span class="string">'./api/collaborators'</span>)
  , configVars = require(<span class="string">'./api/configVars'</span>)
  , domains = require(<span class="string">'./api/domains'</span>)
  , features = require(<span class="string">'./api/features'</span>)
  , keys = require(<span class="string">'./api/keys'</span>)
  , login = require(<span class="string">'./api/login'</span>)
  , logs = require(<span class="string">'./api/logs'</span>)
  , releases = require(<span class="string">'./api/releases'</span>)
  , sslEndpoints = require(<span class="string">'./api/sslEndpoints'</span>)
  , stacks = require(<span class="string">'./api/stacks'</span>)
  , processes = require(<span class="string">'./api/processes'</span>)
  , users = require(<span class="string">'./api/users'</span>);</div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2><a name="herokuapi-constructor" class="anchor" href="#herokuapi-constructor"><span></span></a>HerokuAPI Constructor</h2>
<h3><a name="params" class="anchor" href="#params"><span></span></a>Params</h3>
<ul>
<li><em>options {object} : Key : value of the credentials</em></li>
<li><em>next {Function} : Callback used in case of <code>username</code> and <code>password</code></em></li>
</ul>
<h3><a name="examples" class="anchor" href="#examples"><span></span></a>Examples</h3>
<pre><code class="js"> <span class="comment">// Instantiate with the `HEROKU_API_KEY` set in the environment</span>
 <span class="keyword">var</span> api = <span class="keyword">new</span> HerokuAPI();

 <span class="comment">// Instantiate an API Key</span>
 <span class="keyword">var</span> api = <span class="keyword">new</span> HerokuAPI({<span class="string">"apiKey"</span> : apiKey});

 <span class="comment">// Instantiate with email and API Token</span>
 <span class="keyword">var</span> api = <span class="keyword">new</span> HerokuAPI({<span class="string">"email"</span> : email, <span class="string">"apiToken"</span> : apiToken});

 <span class="comment">// Instantiate with username and password **Async reminder**</span>
 <span class="keyword">new</span> HerokuAPI({ <span class="string">"username"</span> : username, <span class="string">"password"</span> : password }, <span class="keyword">function</span>(api) {
   <span class="comment">// Use the `api` here</span>
 });</code></pre></div></div><div class="code"><div class="wrapper"><span class="function"><span class="keyword">function</span> <span class="title">HerokuAPI</span><span class="params">(options, next)</span> {</span>
  <span class="keyword">var</span> apiKey, username, password;
  <span class="keyword">if</span> (<span class="keyword">typeof</span> options !== <span class="string">'object'</span>) options = {};

  apiKey = options.apiKey || process.env.HEROKU_API_KEY;
  <span class="keyword">if</span> (! apiKey) {
    <span class="keyword">if</span> (options.email &amp;&amp; options.apiToken) {
      apiKey = <span class="string">''</span> + options.email + <span class="string">':'</span> + options.apiToken;
    } <span class="keyword">else</span> <span class="keyword">if</span> (options.username &amp;&amp; options.password) {
      <span class="keyword">if</span> (! next) {
        <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Creation with username and password is async and requires a callback'</span>);
      }
      <span class="keyword">return</span> login.postLogin(options.username, options.password, <span class="keyword">function</span>(err, res) {
        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;

        parseAPIKey.apply(<span class="keyword">this</span>, [res.body[<span class="string">'api_key'</span>]]);
      });
    }
    <span class="keyword">return</span> parseAPIKey.apply(<span class="keyword">this</span>, [apiKey]);
  }

  <span class="function"><span class="keyword">function</span> <span class="title">parseAPIKey</span><span class="params">(key)</span> {</span>
    <span class="keyword">if</span> (! key) <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'No api token provided'</span>);
    <span class="keyword">var</span> apiKey = <span class="keyword">new</span> Buffer(<span class="string">''</span> + key).toString(<span class="string">'base64'</span>);

    superagent.setAPIKey(apiKey);</div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Return via callback if async-driven</p></div></div><div class="code"><div class="wrapper">    <span class="keyword">if</span> (next) <span class="keyword">return</span> next(<span class="keyword">this</span>);

    <span class="keyword">return</span> <span class="keyword">this</span>;
  }
}

extend(HerokuAPI.prototype,
    addons,
    apps,
    attachments,
    collaborators,
    configVars,
    domains,
    features,
    keys,
    logs,
    releases,
    sslEndpoints,
    stacks,
    processes,
    users
  );

module.exports = HerokuAPI;</div></div></div><div id="segment-footer"><div id="footer"><a href="https://github.com/druide/citare-scriptum" target="_blank">Generated by Citare scriptum</a></div></div></div></body></html>